<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backdoor Games Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .games-grid {
            display: grid;
            gap: 15px;
        }
        
        .game-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4cc9f0;
            backdrop-filter: blur(5px);
            transition: transform 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .game-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4cc9f0;
        }
        
        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .last-update {
            text-align: center;
            margin-top: 20px;
            opacity: 0.7;
            font-size: 0.9em;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.8em;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .status-online {
            color: #00ff00;
        }
        
        .status-offline {
            color: #ff4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Backdoor Games Tracker</h1>
            <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–≤ –±—ç–∫–¥–æ—Ä–∞</p>
            <p>–°—Ç–∞—Ç—É—Å: <span id="status" class="status-online">‚úÖ ONLINE</span></p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalGames">0</div>
                <div>–í—Å–µ–≥–æ –∏–≥—Ä</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalLaunches">0</div>
                <div>–í—Å–µ–≥–æ –∑–∞–ø—É—Å–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uniqueGames">0</div>
                <div>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–≥—Ä</div>
            </div>
        </div>
        
        <div id="gamesList" class="games-grid">
            <div class="empty-state" id="emptyState">
                –û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Roblox...
                <div class="log" id="connectionLog"></div>
            </div>
        </div>
        
        <div class="last-update">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate">-</span>
        </div>
    </div>

    <script>
        class BackdoorTracker {
            constructor() {
                this.games = JSON.parse(localStorage.getItem('backdoorGames') || '[]');
                this.requestCount = 0;
                this.init();
            }
            
            init() {
                this.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–∫–µ—Ä–∞...');
                this.setupMessageListener();
                this.handleUrlData();
                this.updateUI();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 500ms
                setInterval(() => {
                    this.handleUrlData();
                    this.updateUI();
                }, 500);
                
                this.log('‚úÖ –¢—Ä–µ–∫–µ—Ä –≥–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É –¥–∞–Ω–Ω—ã—Ö');
                this.log('üì° –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Roblox...');
            }
            
            setupMessageListener() {
                // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç iframe (–¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π)
                window.addEventListener('message', (event) => {
                    if (event.data && event.data.type === 'gameData') {
                        this.addGame(event.data.gameData);
                    }
                });
            }
            
            handleUrlData() {
                const urlParams = new URLSearchParams(window.location.search);
                const dataParam = urlParams.get('data');
                
                if (dataParam && dataParam.length > 0) {
                    this.requestCount++;
                    this.log(`üì® –ó–∞–ø—Ä–æ—Å #${this.requestCount}: –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ`);
                    
                    try {
                        const gameData = JSON.parse(decodeURIComponent(dataParam));
                        this.addGame(gameData);
                        
                        // –û—á–∏—â–∞–µ–º URL
                        window.history.replaceState({}, '', window.location.pathname);
                        
                        this.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                    } catch (e) {
                        this.log('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + e.message);
                        this.log('üì¶ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ' + dataParam.substring(0, 100));
                    }
                }
            }
            
            addGame(newGame) {
                const existingIndex = this.games.findIndex(g => g.placeId === newGame.placeId);
                const now = new Date().toISOString();
                
                if (existingIndex !== -1) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–≥—Ä—É
                    this.games[existingIndex] = {
                        ...this.games[existingIndex],
                        ...newGame,
                        lastSeen: now,
                        seenCount: (this.games[existingIndex].seenCount || 1) + 1,
                        lastPlayers: newGame.players,
                        lastServerId: newGame.serverId
                    };
                    this.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–≥—Ä–∞: ' + newGame.name);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É
                    this.games.push({
                        ...newGame,
                        firstSeen: now,
                        lastSeen: now,
                        seenCount: 1,
                        lastPlayers: newGame.players,
                        lastServerId: newGame.serverId
                    });
                    this.log('üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞: ' + newGame.name);
                }
                
                this.saveData();
                this.updateUI();
            }
            
            saveData() {
                try {
                    localStorage.setItem('backdoorGames', JSON.stringify(this.games));
                } catch (e) {
                    this.log('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage: ' + e.message);
                }
            }
            
            updateUI() {
                const gamesList = document.getElementById('gamesList');
                const emptyState = document.getElementById('emptyState');
                const totalGames = document.getElementById('totalGames');
                const totalLaunches = document.getElementById('totalLaunches');
                const uniqueGames = document.getElementById('uniqueGames');
                const lastUpdate = document.getElementById('lastUpdate');
                const status = document.getElementById('status');
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const launches = this.games.reduce((sum, game) => sum + (game.seenCount || 1), 0);
                totalGames.textContent = this.games.length;
                totalLaunches.textContent = launches;
                uniqueGames.textContent = this.games.length;
                lastUpdate.textContent = new Date().toLocaleString();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                status.textContent = this.games.length > 0 ? '‚úÖ ACTIVE' : '‚úÖ ONLINE';
                
                // –°–ø–∏—Å–æ–∫ –∏–≥—Ä
                if (this.games.length === 0) {
                    emptyState.style.display = 'block';
                    gamesList.innerHTML = '';
                    gamesList.appendChild(emptyState);
                } else {
                    emptyState.style.display = 'none';
                    
                    const sortedGames = [...this.games].sort((a, b) => 
                        new Date(b.lastSeen) - new Date(a.lastSeen)
                    );
                    
                    gamesList.innerHTML = sortedGames.map(game => `
                        <div class="game-card">
                            <div class="game-name">${this.escapeHtml(game.name)}</div>
                            <div class="game-info">
                                <div><strong>Place ID:</strong> ${game.placeId}</div>
                                <div><strong>–°–æ–∑–¥–∞—Ç–µ–ª—å:</strong> ${this.escapeHtml(game.creator)}</div>
                                <div><strong>–ò–≥—Ä–æ–∫–æ–≤:</strong> ${game.lastPlayers || game.players || 0}</div>
                                <div><strong>–ó–∞–ø—É—Å–∫–æ–≤:</strong> ${game.seenCount || 1}</div>
                                <div><strong>Server ID:</strong> ${game.lastServerId || game.serverId || 'N/A'}</div>
                                <div><strong>–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:</strong> ${new Date(game.firstSeen).toLocaleDateString()}</div>
                                <div><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫:</strong> ${new Date(game.lastSeen).toLocaleString()}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            log(message) {
                const logElement = document.getElementById('connectionLog');
                if (logElement) {
                    const timestamp = new Date().toLocaleTimeString();
                    logElement.innerHTML += `[${timestamp}] ${message}<br>`;
                    logElement.scrollTop = logElement.scrollHeight;
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ª–æ–≥ 50 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
                    const messages = logElement.innerHTML.split('<br>');
                    if (messages.length > 50) {
                        logElement.innerHTML = messages.slice(-30).join('<br>');
                    }
                }
                console.log(message);
            }
            
            escapeHtml(text) {
                if (!text) return 'Unknown';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            window.tracker = new BackdoorTracker();
        });
    </script>
</body>
</html>
